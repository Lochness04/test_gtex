library(CePa)
library(dplyr)
library(org.Hs.eg.db)

setwd("C:/Users/nt301/Downloads")

#GTEx gene read count [DF]
DF = read.gct(file = 'GTEx_Analysis_2017-06-05_v8_RNASeQCv1.1.9_gene_reads.gct')
DF = as.data.frame(DF) #or as.matrix()?
colnames(DF) = gsub(".", "-", colnames(DF), fixed = TRUE)
#DF ~56000 obs. 17382 var. | colnames - 17382 IDs

#but DF contains only sample id, I need annotation 

#extract [SAMPID, SMTS, SMTSISCH] from annotation, and there are more IDs - 22951 in annotation vs 17382 in GTEx DF
annotation = read.delim("GTEx_Analysis_v8_Annotations_SampleAttributesDS.txt", header = TRUE, sep = "\t")
SAMPID.SMTS.SMTSISCH = annotation[,c("SAMPID","SMTS","SMTSISCH")]
#SAMPID.SMTS.SMTSISCH 22951 obs. 3 var. | colnames - "SAMPID","SMTS", "SMTSISCH"

#extract [SAMPID] - GTEx IDs are colnames of GTEx df
SAMPID = gsub(".", "-", colnames(DF), fixed = TRUE)
SAMPID = as.data.frame(SAMPID)
colnames(SAMPID) = 'SAMPID'
#SAMPID 17382 obs. 1 var. | colnames - "SAMPID"

#join [SAMPID] from GTEx DF and [SAMPID, SMTS, SMTSISCH] from annotation > [ANNOT]
ANNOT = left_join(SAMPID, SAMPID.SMTS.SMTSISCH)
#ANNOT 17382 obs. 3 var. | colnames "SAMPID","SMTS","SMTSISCH"

#transpose [ANNOT]
ANNOT = t(ANNOT)
colnames(ANNOT) = ANNOT[1,]
#ANNOT 3 obs. 17382 var. | colnames - 17382 IDs

#rbind GTEx gene read counts [DF] and [ANNOT]
DF.ANNOT = rbind(DF, ANNOT)
